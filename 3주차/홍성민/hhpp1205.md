# 지하철 보관함 서비스 장애 대응 문제

## 서비스 구조
- **모바일 앱**: "또타라커"와 유사하게 지하철 내 물품 보관을 위한 사용자 요청 처리
- **API Gateway**: 모바일 앱의 모든 외부 요청 접점
- **Application Server**: 각 출구별 보관함 관리(조회/예약/해제 등) 비즈니스 로직 처리
- **MySQL 서버**: 각 출구별 보관함 정보 저장

---
<img src="https://private-user-images.githubusercontent.com/56379649/494812241-f0272786-c4e2-4173-a010-de44afd1ed75.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTkyMzg2NDIsIm5iZiI6MTc1OTIzODM0MiwicGF0aCI6Ii81NjM3OTY0OS80OTQ4MTIyNDEtZjAyNzI3ODYtYzRlMi00MTczLWEwMTAtZGU0NGFmZDFlZDc1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA5MzAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwOTMwVDEzMTkwMlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWM3ODE4OTg1NDg3MGM0ZTgzZWJhYTk3MDFhN2ZiYzhiMmQ3MTE2YTljOGFkNzRiNGFiZDI1NTYzZDczODUzYTMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.o38zDZigCyesYSQEZpjB2mOxCggZJayo2MRX9_D_424">
---
## 보관함 구성
- **강남역 총 300개 보관함**
    - **A그룹 (A001 ~ A100)**: **1번 출구 MySQL**에만 저장
    - **B그룹 (B001 ~ B100)**: **5번 출구 MySQL**에만 저장
    - **C그룹 (C001 ~ C100)**: **11번 출구 MySQL**에만 저장

> 각 그룹은 특정 출구의 MySQL에만 저장되며, 출구 간 데이터 공유·복제·백업이 없는 **완전 독립 운영** 구조임.

---

## 상황(Incident)
- **5번 출구 시스템 전체 다운** 발생
- 결과적으로 **B그룹(B001~B100) 서비스 중단**
    - B그룹 **사용/조회 불가**
    - **다른 출구**에서도 B그룹 데이터 **조회/처리 불가**
- **시스템 복구 예상 시간**: 약 **6시간**
- 이 기간 동안 관련 서비스 이용 **불가**

---

## 시스템 특징 / 제약
- 각 출구 시스템은 **독립적으로 운영**
- **데이터 공유/복제/백업이 없음**
- 출구 간 **페일오버/대체 경로 부재**

---

## 문제(질문)
단일 출구 장애(예: 5번 출구) 발생 시에도,  
**다른 출구에서 B그룹 보관함에 접근 가능**하도록 하여  
**전체 서비스에 미치는 영향을 최소화**하려면 **어떻게 설계/개선**해야 하는가?

--- 

## 해결 방법 

### 1) Mysql Cluster 구성(InnoDB Cluster, **Single‑Primary**)
Single‑Primary로 구성하여 **하나의 노드에서만 쓰기**를 수행합니다.

### 장점
- **RPO ≈ 0**에 가깝게 설계 가능(재해 발생 시 허용되는 최대 데이터 손실량을 시간으로 측정한 값)
- **장애 복구 시간이 빠름** (장애 발생 시 자동 리더 선출)

### 단점
- **구성과 운영의 복잡성**이 높음 (클러스터/라우터/모니터링 등 운영 난이도 상승)
- **동기 복제로 쓰기 성능 낮음**
  - 다만 서비스(“또타라커”) 특성상 **쓰기 직후 빠른 조회 필요성이 낮다고 판단**되어, 이 단점은 **무시 가능**

---

## 2) Mysql Replication 구성 (비동기/세미싱크)
클래식 복제 구조로 **간단하게 구성**하며, 필요 시 **Replica를 확장**해 읽기 트래픽을 분산합니다.

### 장점
- **구성 간단**, 도입 용이
- **쓰기 성능 우수** (Master에 쓰고 Replica에는 비동기 복제)
- **Replica 확장**을 통한 트래픽 분산이 용이

### 단점
- **RPO = 0이 아님**(재해 발생 시 허용되는 최대 데이터 손실량을 시간으로 측정한 값)
  - 비동기 복제 시 **데이터 손실 가능성** 존재
- **Master 장애 시 복구 절차가 까다로움**
- **Replication Lag** 발생 가능
  - 다만 서비스(“또타라커”) 특성상 **쓰기 직후 빠른 조회 필요성이 낮다고 판단**되어, 이 단점은 **무시 가능**

---

### 결론

- 빠르고 간단한 해결·운영 복잡도 최소화가 최우선이거나, 현재 인력/지식 수준에서 클러스터 운영이 기술부채를 유발할 우려가 있으면 → **Replication(비동기 + 필요 시 세미-싱크)** 를 선택한다.
- 빠른 장애 복구와 적은 데이터 손실이 핵심 목표이고, 구성/운영에 대한 시간과 역량이 충분하다면 → **InnoDB Cluster(Single-Primary)** 를 선택한다.