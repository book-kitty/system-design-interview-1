##  문제



### 서비스 구조

- 모바일 앱 : "또타라커" 앱과 같이 지하철 내 물품을 보관할 수 있도록 사용자의 요청을 처리
- API Gateway : 모바일 앱 요청 처리
- Application Server : 각 출구별 보관함 관리 정보 처리
- MySQL 서버 : 각 출구별 보관함 정보 보관


<img width="453" height="537" alt="Image" src="https://github.com/user-attachments/assets/f0272786-c4e2-4173-a010-de44afd1ed75" />





### 상황

* 강남역 물품 보관함 구성 : 총 300개 보관함 (1번, 5번, 11번 출구에 각 100개씩)
    * A그룹 (A001~A100): 1번출구 MySQL에만 저장
    * B그룹 (B001~B100): 5번출구 MySQL에만 저장
    * C그룹 (C001~C100): 11번출구 MySQL에만 저장

- 5번 출구 시스템이 전체 다운되는 문제가 발생되어, B그룹 서비스가 중단되었다.
    - 이로 인해 B그룹 보관함 사용/조회가 불가하며 다른 출구에서 B그룹 데이터 조회/처리가 불가능한 상황이다.
- 시스템 특징으로는 각 출구 시스템이 독립적으로 운영되어 출구 간에 데이터 공유, 백업이 존재하지 않는다.
- 시스템 복구까지는 6시간 가량 소요될 예정으로 해당 시간 동안에는 관련 서비스 이용이 불가하다.


### 문제
위의 상황을 마주한 상황에서 단일 출구 장애 시 다른 출구에서 B그룹 보관함 접근 가능하게 하는 등의 전체 서비스에 미치는 영향을 최소화하는 방법은?


## 1. 문제 원인 분석
1. 문제의 본질
    - 현재 구조는 출구별로 독립 시스템으로 운영되고 있음
    - 데이터가 한 곳에만 존재하기 때문에 장애 시 해당 그룹 서비스가 중단됨
2. 해결 목표
    - 장애 발생 시에도 다른 출구에서 그룹 데이터가 접근이 가능하도록 설계

## 2. 해결 방안
- Redis Cluster 
- MySQL Cluster

1. 데이터 복제
   - 두 시스템 모두 단일 노드 장애에 대비해 최소 2개 이상의 복제본을 둠
   - 노드 하나가 죽어도 다른 노드에서 데이터 접근 가능
2. 데이터 분산
   - 대용량 데이터 처리를 위해 데이터를 여러 노드에 분산
   - Redis Cluster → key 기반 해시 슬롯
   - MySQL Cluster → 데이터 샤드(NDB 샤드)
3. 고가용성 설계
   - 장애 시 읽기/쓰기 경로를 살아있는 노드로 자동 전환

## 3. 결론
- Redis Cluster 선택
   - 보관함 특성상 영속성보단 휘발성이 강함
   - 따라서 보관함 데이터는 Redis Cluster로 관리하고, 사용 기록같은 영구적인 데이터는 MySQL로 관리
