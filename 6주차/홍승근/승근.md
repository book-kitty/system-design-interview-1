## 문제

### 1. 배경
> 당신은 대규모 실시간 채팅 애플리케이션 LIME 설계자입니다.
LIME은 데스크톱 앱(Windows/macOS), 모바일 앱(iOS/Android) 을 모두 지원하며, 1:1, 그룹, 공개 채널(오픈채팅) 기능을 제공합니다.
회사는 글로벌 출시를 앞두고 있으며, 성능·안정성·확장성 사이의 어려운 trade-off가 예상되는 요구 사항을 당신에게 전달했습니다.

### 2. 요구 사항
- 실시간성
    - 각 사용자는 자신이 속한 리전 내에서 **100ms 이내에 메시지를 수신해야 한다**.
    - 리전 간 대화의 경우 **200ms 이내에 메시지가 전달되어야 하며**, 네트워크 지연이 있더라도 사용자는 **즉시 반응을 체감해야 한다**.
- 내결함성/내구성
    - 메시지는 모든 복제본(AZ 간 포함)의 디스크 커밋이 완료된 후에만 **전달 확정(ACK)으로 간주한다**.
    - 단일 노드 또는 단일 AZ 장애로 인해 **메시지 유실이 발생해서는 안 된다**.
- 순서/일관성
    - 동일한 방 내의 모든 참여자는 **동일한 순서로 메시지가 보여야 한다**.
- 트래픽 규모
    - DAU 기준 **5천만 명을 예상**한다.
- 확장성
    - 트래픽이 증가해도 **아키텍처 구조 변경 없이 확장 가능해야 한다**.
- 재접속 복구
    - 사용자가 앱/브라우저를 재시작하거나 네트워크가 전환하더라도, 마지막 읽은 메시지 이후의 내역이 **1초 이내로 복원**되어야 한다.

> 회사 경영진은 위의 모든 요구 사항을 서비스 성공을 위한 핵심 목표로 설정하고 있습니다.
당신은 이 요구 사항을 바탕으로,
**서비스의 본질적 가치**를 훼손하지 않으면서 현실적으로 구현 가능한 아키텍처(통신 계층–메시징 계층–저장 계층)를 설계해야 합니다.

## 1. 설계 목표
- 모든 요구사항을 100% 동시 충족은 현실적으로 어려움(사실상 불가)
- 채팅 어플리케이션에서 가장 중요한 점은 대화하는 내용이 실시간으로 오고 가야 한다고 생각
- 실시간성을 최우선으로 보장하고, 내구성/내결함성은 운영 가능한 범위에서 완화

## 2. 컴포넌트 구조
- WebSocket Gateway
  - 실시간 연결 유지 및 메세지 수신/송신 담당 
- Kafka broker
  - 메시지를 저장·전달하는 역할
  - 리전 내에 3개의 AZ로 구성되어 각 브로커가 서로 복제
  - 토픽
    - ingress.msg : 게이트웨이 수신 원본 메시지 큐
    - room.log : 가공된 정본 메시지 로그
    - fanout.task : 사용자 푸시 트리거 이벤트 큐
    - cursor.read : 읽음 커서 변경 이벤트 큐
- Message Router
  - ingress.msg에 들어간 메세지를 room.log
- Fanout Worker

### 2-1. 동작 흐름
1. 메세지 수신
   - 클라이언트는 지역 단위로 관리되는 WebSocket Gateway에 연결하고 메세지 전송
   - 해당 메세지를 ingress.msg에 전달
2. 메시지 처리
   - ingress.msg의 메세지를 가공해서 room.log, fanout.task에 기록

   